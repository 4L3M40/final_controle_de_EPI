{% extends "base.html" %}
{% block title %}Relatório por Colaborador{% endblock %}
{% block content %}
<h1 class="h4 my-3">Relatório — Empréstimos por Colaborador</h1>
<form method="get" class="d-inline-flex align-items-center gap-2 mb-3">
  <input class="form-control" type="text" name="nome" placeholder="Nome do colaborador..." value="{{ nome }}">
  <button class="btn btn-outline-secondary" type="submit">Pesquisar</button>
  <a class="btn btn-outline-secondary" href="{% url 'epi:relatorio_colaborador_csv' %}?nome={{ nome|urlencode }}">Exportar CSV</a>
</form>
<table class="table table-striped table-hover align-middle">
  <thead class="table-light">
    <tr><th>Colaborador</th><th>EPI</th><th>Qtde</th><th>Empréstimo</th><th>Prev. Devolução</th><th>Status</th></tr>
  </thead>
  <tbody>
    {% for i in itens %}
      <tr>
        <td>{{ i.emprestimo.colaborador.nome }}</td>
        <td>{{ i.epi.nome }}</td>
        <td>{{ i.quantidade }}</td>
        <td>{{ i.emprestimo.criado_em|date:"d/m/Y H:i" }}</td>
        <td>{{ i.emprestimo.previsao_devolucao|date:"d/m/Y H:i" }}</td>
        <td>{{ i.get_status_display }}{% if i.devolvido_em %} ({{ i.devolvido_em|date:"d/m/Y H:i" }}){% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="6">Nenhum registro encontrado.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
